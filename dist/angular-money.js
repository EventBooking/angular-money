Angular.module("ngMoney", []);
var MoneyModule;
(function (MoneyModule) {
    var MoneyInputController = /** @class */ (function () {
        function MoneyInputController() {
        }
        MoneyInputController.prototype.onInit = function (view) {
            this.view = view;
            this.setView(this.value);
        };
        Object.defineProperty(MoneyInputController.prototype, "currency", {
            get: function () {
                return this._currency;
            },
            set: function (value) {
                this._currency = value;
                this.symbol = null;
                if (value != null)
                    this.symbol = currency.symbolize(this.currency);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(MoneyInputController.prototype, "value", {
            get: function () {
                return this._value;
            },
            set: function (value) {
                this._value = accounting.unformat(value);
                this.setView(this._value);
            },
            enumerable: true,
            configurable: true
        });
        MoneyInputController.prototype.setView = function (value) {
            this.money = null;
            if (value == null)
                return;
            this.money = accounting.formatMoney(value, {
                symbol: this.symbol
            });
            if (this.view != null)
                this.view.setViewValue(this.money);
        };
        return MoneyInputController;
    }());
    Angular.module("ngMoney").controller("moneyInput", MoneyInputController);
    var MoneyInputDirective = /** @class */ (function () {
        function MoneyInputDirective() {
            var _this = this;
            this.restrict = 'A';
            this.require = 'ngModel';
            this.controller = MoneyInputController;
            this.controllerAs = 'moneyInput';
            this.bindToController = true;
            this.scope = {
                value: '=moneyInput',
                currency: '@'
            };
            this.link = function ($scope, $element, $attrs, ngModelCtrl) {
                var $ctrl = $scope[_this.controllerAs];
                $element.on("blur." + $scope.$id, function () {
                    $ctrl.value = ngModelCtrl.$modelValue;
                });
                $scope.$on('$destroy', function () {
                    $element.off("blur." + $scope.$id);
                });
                var view = {
                    setViewValue: function (value) {
                        ngModelCtrl.$setViewValue(value);
                        ngModelCtrl.$render();
                    }
                };
                $ctrl.onInit(view);
            };
        }
        MoneyInputDirective.$inject = [];
        return MoneyInputDirective;
    }());
    Angular.module("ngMoney").directive("moneyInput", MoneyInputDirective);
})(MoneyModule || (MoneyModule = {}));
var MoneyModule;
(function (MoneyModule) {
    var MoneyFiltersModule;
    (function (MoneyFiltersModule) {
        var MoneyFilter = /** @class */ (function () {
            function MoneyFilter() {
            }
            MoneyFilter.prototype.filter = function (value, code, options) {
                if (value == null || angular.isString(value) && value.trim().length === 0)
                    return "";
                var _options = {
                    precision: accounting.settings.currency.precision
                };
                if (angular.isObject(code)) {
                    _options = code;
                    code = null;
                }
                if (value.amount) {
                    code = value.currency || code;
                    value = value.amount;
                }
                if (!options)
                    options = {};
                for (var x in options)
                    _options[x] = options[x];
                var v = accounting.unformat(value);
                if (options.abbrev) {
                    if (v >= 1000000) {
                        value = v / 1000000;
                        _options.precision = value.toString().indexOf('.') > 0 ? 1 : 0;
                        _options.format = "%s%vM";
                    }
                    else if (v >= 1000) {
                        value = v / 1000;
                        _options.precision = value.toString().indexOf('.') > 0 ? 1 : 0;
                        _options.format = "%s%vK";
                    }
                    else if (v >= 100) {
                        value = v;
                        _options.precision = value.toString().indexOf('.') > 0 ? _options.precision : 0;
                        _options.format = "%s%v";
                    }
                    else if (v >= 10) {
                        value = v;
                        _options.precision = value.toString().indexOf('.') > 0 ? _options.precision : 0;
                        _options.format = "%s%v";
                    }
                }
                _options.symbol = currency.symbolize(code);
                var result = accounting.formatMoney(value, _options);
                return result;
            };
            return MoneyFilter;
        }());
        Angular.module("ngMoney").filter("money", MoneyFilter);
    })(MoneyFiltersModule || (MoneyFiltersModule = {}));
})(MoneyModule || (MoneyModule = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1tb25leS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAudHMiLCIuLi9zcmMvbW9uZXktaW5wdXQudHMiLCIuLi9zcmMvbW9uZXktZmlsdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FDQTlCLElBQU8sV0FBVyxDQThHakI7QUE5R0QsV0FBTyxXQUFXO0lBV2Q7UUFDSTtRQUNBLENBQUM7UUFFRCxxQ0FBTSxHQUFOLFVBQU8sSUFBcUI7WUFDeEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDakIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsQ0FBQztRQUlELHNCQUFJLDBDQUFRO2lCQUFaO2dCQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQzFCLENBQUM7aUJBRUQsVUFBYSxLQUFhO2dCQUN0QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztnQkFFdkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUM7Z0JBQ25CLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7b0JBQ2QsSUFBSSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUN4RCxDQUFDOzs7V0FSQTtRQVlELHNCQUFJLHVDQUFLO2lCQUFUO2dCQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQ3ZCLENBQUM7aUJBRUQsVUFBVSxLQUFhO2dCQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3pDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlCLENBQUM7OztXQUxBO1FBT08sc0NBQU8sR0FBZixVQUFnQixLQUFLO1lBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1lBRWxCLEVBQUUsQ0FBQyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7Z0JBQ2QsTUFBTSxDQUFDO1lBRVgsSUFBSSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRTtnQkFDdkMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNO2FBQ3RCLENBQUMsQ0FBQztZQUVILEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDO2dCQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUtMLDJCQUFDO0lBQUQsQ0FBQyxBQW5ERCxJQW1EQztJQUVELE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO0lBTXpFO1FBR0k7WUFBQSxpQkFBaUI7WUFFakIsYUFBUSxHQUFHLEdBQUcsQ0FBQztZQUNmLFlBQU8sR0FBRyxTQUFTLENBQUM7WUFDcEIsZUFBVSxHQUFHLG9CQUFvQixDQUFDO1lBQ2xDLGlCQUFZLEdBQUcsWUFBWSxDQUFDO1lBQzVCLHFCQUFnQixHQUFHLElBQUksQ0FBQztZQUN4QixVQUFLLEdBQUc7Z0JBQ0osS0FBSyxFQUFFLGFBQWE7Z0JBQ3BCLFFBQVEsRUFBRSxHQUFHO2FBQ2hCLENBQUM7WUFFRixTQUFJLEdBQUcsVUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXO2dCQUN6QyxJQUFJLEtBQUssR0FBeUIsTUFBTSxDQUFDLEtBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFNUQsUUFBUSxDQUFDLEVBQUUsQ0FBQyxVQUFRLE1BQU0sQ0FBQyxHQUFLLEVBQUU7b0JBQzlCLEtBQUssQ0FBQyxLQUFLLEdBQUcsV0FBVyxDQUFDLFdBQVcsQ0FBQztnQkFDMUMsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUU7b0JBQ25CLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBUSxNQUFNLENBQUMsR0FBSyxDQUFDLENBQUM7Z0JBQ3ZDLENBQUMsQ0FBQyxDQUFDO2dCQUVILElBQUksSUFBSSxHQUFvQjtvQkFDeEIsWUFBWSxFQUFaLFVBQWEsS0FBSzt3QkFDZCxXQUFXLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUNqQyxXQUFXLENBQUMsT0FBTyxFQUFFLENBQUM7b0JBQzFCLENBQUM7aUJBQ0osQ0FBQTtnQkFFRCxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3ZCLENBQUMsQ0FBQztRQS9CYyxDQUFDO1FBRlYsMkJBQU8sR0FBRyxFQUFFLENBQUM7UUFvQ3hCLDBCQUFDO0tBQUEsQUFyQ0QsSUFxQ0M7SUFFRCxPQUFPLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztBQUMzRSxDQUFDLEVBOUdNLFdBQVcsS0FBWCxXQUFXLFFBOEdqQjtBQzlHRCxJQUFPLFdBQVcsQ0FzRWpCO0FBdEVELFdBQU8sV0FBVztJQUlkLElBQU8sa0JBQWtCLENBaUV4QjtJQWpFRCxXQUFPLGtCQUFrQjtRQUtyQjtZQUFBO1lBeURBLENBQUM7WUF4REcsNEJBQU0sR0FBTixVQUFPLEtBQVUsRUFBRSxJQUFhLEVBQUUsT0FBYTtnQkFDM0MsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksSUFBSSxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO29CQUN0RSxNQUFNLENBQUMsRUFBRSxDQUFDO2dCQUVkLElBQUksUUFBUSxHQUFRO29CQUNoQixTQUFTLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsU0FBUztpQkFDcEQsQ0FBQztnQkFFRixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDekIsUUFBUSxHQUFHLElBQUksQ0FBQztvQkFDaEIsSUFBSSxHQUFHLElBQUksQ0FBQztnQkFDaEIsQ0FBQztnQkFFRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDZixJQUFJLEdBQUcsS0FBSyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUM7b0JBQzlCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO2dCQUN6QixDQUFDO2dCQUVELEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO29CQUNULE9BQU8sR0FBRyxFQUFFLENBQUM7Z0JBRWpCLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQztvQkFDakIsUUFBUSxDQUFDLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFN0IsSUFBSSxDQUFDLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbkMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0JBQ2pCLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO3dCQUNmLEtBQUssR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDO3dCQUNwQixRQUFRLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDL0QsUUFBUSxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUM7b0JBQzlCLENBQUM7b0JBRUQsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO3dCQUNqQixLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQzt3QkFDakIsUUFBUSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQy9ELFFBQVEsQ0FBQyxNQUFNLEdBQUcsT0FBTyxDQUFDO29CQUM5QixDQUFDO29CQUVELElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQzt3QkFDZixLQUFLLEdBQUcsQ0FBQyxDQUFDO3dCQUNWLFFBQVEsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDaEYsUUFBUSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7b0JBQzdCLENBQUM7b0JBRUQsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO3dCQUNkLEtBQUssR0FBRyxDQUFDLENBQUM7d0JBQ1YsUUFBUSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoRixRQUFRLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztvQkFDN0IsQ0FBQztnQkFDTCxDQUFDO2dCQUVELFFBQVEsQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFFM0MsSUFBSSxNQUFNLEdBQUcsVUFBVSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ3JELE1BQU0sQ0FBQyxNQUFNLENBQUM7WUFDbEIsQ0FBQztZQUNMLGtCQUFDO1FBQUQsQ0FBQyxBQXpERCxJQXlEQztRQUVELE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUMzRCxDQUFDLEVBakVNLGtCQUFrQixLQUFsQixrQkFBa0IsUUFpRXhCO0FBQ0wsQ0FBQyxFQXRFTSxXQUFXLEtBQVgsV0FBVyxRQXNFakIiLCJzb3VyY2VzQ29udGVudCI6WyJBbmd1bGFyLm1vZHVsZShcIm5nTW9uZXlcIiwgW10pOyIsIm1vZHVsZSBNb25leU1vZHVsZSB7XHJcbiAgICBkZWNsYXJlIHZhciBhY2NvdW50aW5nOiBhbnk7XHJcbiAgICBkZWNsYXJlIHZhciBjdXJyZW5jeTogYW55O1xyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSU1vbmV5SW5wdXRDb250cm9sbGVyIHtcclxuICAgICAgICB2YWx1ZTogc3RyaW5nO1xyXG4gICAgICAgIGN1cnJlbmN5OiBzdHJpbmc7XHJcbiAgICAgICAgbW9uZXk6IHN0cmluZztcclxuICAgICAgICBzeW1ib2w6IHN0cmluZztcclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBNb25leUlucHV0Q29udHJvbGxlciBpbXBsZW1lbnRzIElNb25leUlucHV0Q29udHJvbGxlciB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvbkluaXQodmlldzogSU1vbmV5SW5wdXRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHZpZXc7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Vmlldyh0aGlzLnZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgX2N1cnJlbmN5OiBzdHJpbmc7XHJcblxyXG4gICAgICAgIGdldCBjdXJyZW5jeSgpOiBzdHJpbmcge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVuY3k7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXQgY3VycmVuY3kodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgICAgICB0aGlzLl9jdXJyZW5jeSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zeW1ib2wgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sID0gY3VycmVuY3kuc3ltYm9saXplKHRoaXMuY3VycmVuY3kpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBfdmFsdWU6IHN0cmluZztcclxuXHJcbiAgICAgICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldCB2YWx1ZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gYWNjb3VudGluZy51bmZvcm1hdCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Vmlldyh0aGlzLl92YWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHNldFZpZXcodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5tb25leSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW9uZXkgPSBhY2NvdW50aW5nLmZvcm1hdE1vbmV5KHZhbHVlLCB7XHJcbiAgICAgICAgICAgICAgICBzeW1ib2w6IHRoaXMuc3ltYm9sXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmlldyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnNldFZpZXdWYWx1ZSh0aGlzLm1vbmV5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1vbmV5OiBzdHJpbmc7XHJcbiAgICAgICAgc3ltYm9sOiBzdHJpbmc7XHJcbiAgICAgICAgcHJpdmF0ZSB2aWV3OiBJTW9uZXlJbnB1dFZpZXc7XHJcbiAgICB9XHJcblxyXG4gICAgQW5ndWxhci5tb2R1bGUoXCJuZ01vbmV5XCIpLmNvbnRyb2xsZXIoXCJtb25leUlucHV0XCIsIE1vbmV5SW5wdXRDb250cm9sbGVyKTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElNb25leUlucHV0VmlldyB7XHJcbiAgICAgICAgc2V0Vmlld1ZhbHVlKHZhbHVlKTogdm9pZDtcclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBNb25leUlucHV0RGlyZWN0aXZlIHtcclxuICAgICAgICBzdGF0aWMgJGluamVjdCA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICAgICAgICByZXN0cmljdCA9ICdBJztcclxuICAgICAgICByZXF1aXJlID0gJ25nTW9kZWwnO1xyXG4gICAgICAgIGNvbnRyb2xsZXIgPSBNb25leUlucHV0Q29udHJvbGxlcjtcclxuICAgICAgICBjb250cm9sbGVyQXMgPSAnbW9uZXlJbnB1dCc7XHJcbiAgICAgICAgYmluZFRvQ29udHJvbGxlciA9IHRydWU7XHJcbiAgICAgICAgc2NvcGUgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlOiAnPW1vbmV5SW5wdXQnLFxyXG4gICAgICAgICAgICBjdXJyZW5jeTogJ0AnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGluayA9ICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsIG5nTW9kZWxDdHJsKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciAkY3RybDogTW9uZXlJbnB1dENvbnRyb2xsZXIgPSAkc2NvcGVbdGhpcy5jb250cm9sbGVyQXNdO1xyXG5cclxuICAgICAgICAgICAgJGVsZW1lbnQub24oYGJsdXIuJHskc2NvcGUuJGlkfWAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnZhbHVlID0gbmdNb2RlbEN0cmwuJG1vZGVsVmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkZWxlbWVudC5vZmYoYGJsdXIuJHskc2NvcGUuJGlkfWApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciB2aWV3OiBJTW9uZXlJbnB1dFZpZXcgPSB7XHJcbiAgICAgICAgICAgICAgICBzZXRWaWV3VmFsdWUodmFsdWUpOiB2b2lkIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjdHJsLm9uSW5pdCh2aWV3KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgQW5ndWxhci5tb2R1bGUoXCJuZ01vbmV5XCIpLmRpcmVjdGl2ZShcIm1vbmV5SW5wdXRcIiwgTW9uZXlJbnB1dERpcmVjdGl2ZSk7XHJcbn0iLCJtb2R1bGUgTW9uZXlNb2R1bGUge1xyXG4gICAgZGVjbGFyZSB2YXIgYWNjb3VudGluZzogYW55O1xyXG4gICAgZGVjbGFyZSB2YXIgY3VycmVuY3k6IGFueTtcclxuXHJcbiAgICBtb2R1bGUgTW9uZXlGaWx0ZXJzTW9kdWxlIHtcclxuICAgICAgICBleHBvcnQgaW50ZXJmYWNlIElNb25leUZpbHRlciB7XHJcbiAgICAgICAgICAgIGZpbHRlcih2YWx1ZTogYW55LCBjb2RlPzogc3RyaW5nLCBvcHRpb25zPzogYW55KTogc3RyaW5nXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbGFzcyBNb25leUZpbHRlciBpbXBsZW1lbnRzIElNb25leUZpbHRlciB7XHJcbiAgICAgICAgICAgIGZpbHRlcih2YWx1ZTogYW55LCBjb2RlPzogc3RyaW5nLCBvcHRpb25zPzogYW55KTogc3RyaW5nIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IGFuZ3VsYXIuaXNTdHJpbmcodmFsdWUpICYmIHZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIF9vcHRpb25zOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uOiBhY2NvdW50aW5nLnNldHRpbmdzLmN1cnJlbmN5LnByZWNpc2lvblxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc09iamVjdChjb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9vcHRpb25zID0gY29kZTtcclxuICAgICAgICAgICAgICAgICAgICBjb2RlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYW1vdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZSA9IHZhbHVlLmN1cnJlbmN5IHx8IGNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5hbW91bnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIHggaW4gb3B0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICBfb3B0aW9uc1t4XSA9IG9wdGlvbnNbeF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHYgPSBhY2NvdW50aW5nLnVuZm9ybWF0KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFiYnJldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2ID49IDEwMDAwMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2IC8gMTAwMDAwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMucHJlY2lzaW9uID0gdmFsdWUudG9TdHJpbmcoKS5pbmRleE9mKCcuJykgPiAwID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLmZvcm1hdCA9IFwiJXMldk1cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYgPj0gMTAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHYgLyAxMDAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfb3B0aW9ucy5wcmVjaXNpb24gPSB2YWx1ZS50b1N0cmluZygpLmluZGV4T2YoJy4nKSA+IDAgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMuZm9ybWF0ID0gXCIlcyV2S1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih2ID49IDEwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLnByZWNpc2lvbiA9IHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZignLicpID4gMCA/IF9vcHRpb25zLnByZWNpc2lvbiA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLmZvcm1hdCA9IFwiJXMldlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih2ID49IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMucHJlY2lzaW9uID0gdmFsdWUudG9TdHJpbmcoKS5pbmRleE9mKCcuJykgPiAwID8gX29wdGlvbnMucHJlY2lzaW9uIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMuZm9ybWF0ID0gXCIlcyV2XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIF9vcHRpb25zLnN5bWJvbCA9IGN1cnJlbmN5LnN5bWJvbGl6ZShjb2RlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gYWNjb3VudGluZy5mb3JtYXRNb25leSh2YWx1ZSwgX29wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBBbmd1bGFyLm1vZHVsZShcIm5nTW9uZXlcIikuZmlsdGVyKFwibW9uZXlcIiwgTW9uZXlGaWx0ZXIpO1xyXG4gICAgfVxyXG59Il19