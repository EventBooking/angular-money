Angular.module("ngMoney", []);
var MoneyModule;
(function (MoneyModule) {
    var MoneyInputController = (function () {
        function MoneyInputController() {
        }
        MoneyInputController.prototype.onInit = function (view) {
            this.view = view;
            this.setView(this.value);
        };
        Object.defineProperty(MoneyInputController.prototype, "currency", {
            get: function () {
                return this._currency;
            },
            set: function (value) {
                this._currency = value;
                this.symbol = null;
                if (value != null)
                    this.symbol = currency.symbolize(this.currency);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(MoneyInputController.prototype, "value", {
            get: function () {
                return this._value;
            },
            set: function (value) {
                this._value = accounting.unformat(value);
                this.setView(this._value);
            },
            enumerable: true,
            configurable: true
        });
        MoneyInputController.prototype.setView = function (value) {
            this.money = null;
            if (value == null)
                return;
            this.money = accounting.formatMoney(value, {
                symbol: this.symbol
            });
            if (this.view != null)
                this.view.setViewValue(this.money);
        };
        return MoneyInputController;
    }());
    Angular.module("ngMoney").controller("moneyInput", MoneyInputController);
    var MoneyInputDirective = (function () {
        function MoneyInputDirective() {
            var _this = this;
            this.restrict = 'A';
            this.require = 'ngModel';
            this.controller = MoneyInputController;
            this.controllerAs = 'moneyInput';
            this.bindToController = true;
            this.scope = {
                value: '=moneyInput',
                currency: '@'
            };
            this.link = function ($scope, $element, $attrs, ngModelCtrl) {
                var $ctrl = $scope[_this.controllerAs];
                $element.on("blur." + $scope.$id, function () {
                    $ctrl.value = ngModelCtrl.$modelValue;
                });
                $scope.$on('$destroy', function () {
                    $element.off("blur." + $scope.$id);
                });
                var view = {
                    setViewValue: function (value) {
                        ngModelCtrl.$setViewValue(value);
                        ngModelCtrl.$render();
                    }
                };
                $ctrl.onInit(view);
            };
        }
        MoneyInputDirective.$inject = [];
        return MoneyInputDirective;
    }());
    Angular.module("ngMoney").directive("moneyInput", MoneyInputDirective);
})(MoneyModule || (MoneyModule = {}));
var MoneyModule;
(function (MoneyModule) {
    var MoneyFiltersModule;
    (function (MoneyFiltersModule) {
        var MoneyFilter = (function () {
            function MoneyFilter() {
            }
            MoneyFilter.prototype.filter = function (value, code, options) {
                if (value == null || angular.isString(value) && value.trim().length === 0)
                    return "";
                var _options = {
                    precision: accounting.settings.currency.precision
                };
                if (angular.isObject(code)) {
                    _options = code;
                    code = null;
                }
                if (value.amount) {
                    code = value.currency || code;
                    value = value.amount;
                }
                if (!options)
                    options = {};
                for (var x in options)
                    _options[x] = options[x];
                var v = accounting.unformat(value);
                if (options.abbrev) {
                    if (v >= 1000000) {
                        value = v / 1000000;
                        _options.precision = value.toString().indexOf('.') > 0 ? 1 : 0;
                        _options.format = "%s%vM";
                    }
                    else if (v >= 1000) {
                        value = v / 1000;
                        _options.precision = value.toString().indexOf('.') > 0 ? 1 : 0;
                        _options.format = "%s%vK";
                    }
                    else if (v >= 100) {
                        value = v;
                        _options.precision = value.toString().indexOf('.') > 0 ? _options.precision : 0;
                        _options.format = "%s%v";
                    }
                    else if (v >= 10) {
                        value = v;
                        _options.precision = value.toString().indexOf('.') > 0 ? _options.precision : 0;
                        _options.format = "%s%v";
                    }
                }
                _options.symbol = currency.symbolize(code);
                var result = accounting.formatMoney(value, _options);
                return result;
            };
            return MoneyFilter;
        }());
        Angular.module("ngMoney").filter("money", MoneyFilter);
    })(MoneyFiltersModule || (MoneyFiltersModule = {}));
})(MoneyModule || (MoneyModule = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1tb25leS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9hcHAudHMiLCIuLi9zcmMvbW9uZXktaW5wdXQudHMiLCIuLi9zcmMvbW9uZXktZmlsdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FDQTlCLElBQU8sV0FBVyxDQThHakI7QUE5R0QsV0FBTyxXQUFXLEVBQUMsQ0FBQztJQVdoQjtRQUNJO1FBQ0EsQ0FBQztRQUVELHFDQUFNLEdBQU4sVUFBTyxJQUFxQjtZQUN4QixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztZQUNqQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixDQUFDO1FBSUQsc0JBQUksMENBQVE7aUJBQVo7Z0JBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDMUIsQ0FBQztpQkFFRCxVQUFhLEtBQWE7Z0JBQ3RCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDO2dCQUV2QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztnQkFDbkIsRUFBRSxDQUFDLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQztvQkFDZCxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3hELENBQUM7OztXQVJBO1FBWUQsc0JBQUksdUNBQUs7aUJBQVQ7Z0JBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDdkIsQ0FBQztpQkFFRCxVQUFVLEtBQWE7Z0JBQ25CLElBQUksQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDOUIsQ0FB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LE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUMzRCxDQUFDLEVBakVNLGtCQUFrQixLQUFsQixrQkFBa0IsUUFpRXhCO0FBQ0wsQ0FBQyxFQXRFTSxXQUFXLEtBQVgsV0FBVyxRQXNFakIiLCJzb3VyY2VzQ29udGVudCI6WyJBbmd1bGFyLm1vZHVsZShcIm5nTW9uZXlcIiwgW10pOyIsIm1vZHVsZSBNb25leU1vZHVsZSB7XHJcbiAgICBkZWNsYXJlIHZhciBhY2NvdW50aW5nOiBhbnk7XHJcbiAgICBkZWNsYXJlIHZhciBjdXJyZW5jeTogYW55O1xyXG5cclxuICAgIGV4cG9ydCBpbnRlcmZhY2UgSU1vbmV5SW5wdXRDb250cm9sbGVyIHtcclxuICAgICAgICB2YWx1ZTogc3RyaW5nO1xyXG4gICAgICAgIGN1cnJlbmN5OiBzdHJpbmc7XHJcbiAgICAgICAgbW9uZXk6IHN0cmluZztcclxuICAgICAgICBzeW1ib2w6IHN0cmluZztcclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBNb25leUlucHV0Q29udHJvbGxlciBpbXBsZW1lbnRzIElNb25leUlucHV0Q29udHJvbGxlciB7XHJcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBvbkluaXQodmlldzogSU1vbmV5SW5wdXRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHZpZXc7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Vmlldyh0aGlzLnZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHByaXZhdGUgX2N1cnJlbmN5OiBzdHJpbmc7XHJcblxyXG4gICAgICAgIGdldCBjdXJyZW5jeSgpOiBzdHJpbmcge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVuY3k7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBzZXQgY3VycmVuY3kodmFsdWU6IHN0cmluZykge1xyXG4gICAgICAgICAgICB0aGlzLl9jdXJyZW5jeSA9IHZhbHVlO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zeW1ib2wgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHRoaXMuc3ltYm9sID0gY3VycmVuY3kuc3ltYm9saXplKHRoaXMuY3VycmVuY3kpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcHJpdmF0ZSBfdmFsdWU6IHN0cmluZztcclxuXHJcbiAgICAgICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl92YWx1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHNldCB2YWx1ZSh2YWx1ZTogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZhbHVlID0gYWNjb3VudGluZy51bmZvcm1hdCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0Vmlldyh0aGlzLl92YWx1ZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBwcml2YXRlIHNldFZpZXcodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5tb25leSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbClcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuXHJcbiAgICAgICAgICAgIHRoaXMubW9uZXkgPSBhY2NvdW50aW5nLmZvcm1hdE1vbmV5KHZhbHVlLCB7XHJcbiAgICAgICAgICAgICAgICBzeW1ib2w6IHRoaXMuc3ltYm9sXHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMudmlldyAhPSBudWxsKVxyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnNldFZpZXdWYWx1ZSh0aGlzLm1vbmV5KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG1vbmV5OiBzdHJpbmc7XHJcbiAgICAgICAgc3ltYm9sOiBzdHJpbmc7XHJcbiAgICAgICAgcHJpdmF0ZSB2aWV3OiBJTW9uZXlJbnB1dFZpZXc7XHJcbiAgICB9XHJcblxyXG4gICAgQW5ndWxhci5tb2R1bGUoXCJuZ01vbmV5XCIpLmNvbnRyb2xsZXIoXCJtb25leUlucHV0XCIsIE1vbmV5SW5wdXRDb250cm9sbGVyKTtcclxuXHJcbiAgICBleHBvcnQgaW50ZXJmYWNlIElNb25leUlucHV0VmlldyB7XHJcbiAgICAgICAgc2V0Vmlld1ZhbHVlKHZhbHVlKTogdm9pZDtcclxuICAgIH1cclxuXHJcbiAgICBjbGFzcyBNb25leUlucHV0RGlyZWN0aXZlIHtcclxuICAgICAgICBzdGF0aWMgJGluamVjdCA9IFtdO1xyXG5cclxuICAgICAgICBjb25zdHJ1Y3RvcigpIHsgfVxyXG5cclxuICAgICAgICByZXN0cmljdCA9ICdBJztcclxuICAgICAgICByZXF1aXJlID0gJ25nTW9kZWwnO1xyXG4gICAgICAgIGNvbnRyb2xsZXIgPSBNb25leUlucHV0Q29udHJvbGxlcjtcclxuICAgICAgICBjb250cm9sbGVyQXMgPSAnbW9uZXlJbnB1dCc7XHJcbiAgICAgICAgYmluZFRvQ29udHJvbGxlciA9IHRydWU7XHJcbiAgICAgICAgc2NvcGUgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlOiAnPW1vbmV5SW5wdXQnLFxyXG4gICAgICAgICAgICBjdXJyZW5jeTogJ0AnXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGluayA9ICgkc2NvcGUsICRlbGVtZW50LCAkYXR0cnMsIG5nTW9kZWxDdHJsKSA9PiB7XHJcbiAgICAgICAgICAgIHZhciAkY3RybDogTW9uZXlJbnB1dENvbnRyb2xsZXIgPSAkc2NvcGVbdGhpcy5jb250cm9sbGVyQXNdO1xyXG5cclxuICAgICAgICAgICAgJGVsZW1lbnQub24oYGJsdXIuJHskc2NvcGUuJGlkfWAsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICRjdHJsLnZhbHVlID0gbmdNb2RlbEN0cmwuJG1vZGVsVmFsdWU7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgJHNjb3BlLiRvbignJGRlc3Ryb3knLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAkZWxlbWVudC5vZmYoYGJsdXIuJHskc2NvcGUuJGlkfWApO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciB2aWV3OiBJTW9uZXlJbnB1dFZpZXcgPSB7XHJcbiAgICAgICAgICAgICAgICBzZXRWaWV3VmFsdWUodmFsdWUpOiB2b2lkIHtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kc2V0Vmlld1ZhbHVlKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICBuZ01vZGVsQ3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICRjdHJsLm9uSW5pdCh2aWV3KTtcclxuICAgICAgICB9O1xyXG5cclxuXHJcbiAgICB9XHJcblxyXG4gICAgQW5ndWxhci5tb2R1bGUoXCJuZ01vbmV5XCIpLmRpcmVjdGl2ZShcIm1vbmV5SW5wdXRcIiwgTW9uZXlJbnB1dERpcmVjdGl2ZSk7XHJcbn0iLCJtb2R1bGUgTW9uZXlNb2R1bGUge1xyXG4gICAgZGVjbGFyZSB2YXIgYWNjb3VudGluZzogYW55O1xyXG4gICAgZGVjbGFyZSB2YXIgY3VycmVuY3k6IGFueTtcclxuXHJcbiAgICBtb2R1bGUgTW9uZXlGaWx0ZXJzTW9kdWxlIHtcclxuICAgICAgICBleHBvcnQgaW50ZXJmYWNlIElNb25leUZpbHRlciB7XHJcbiAgICAgICAgICAgIGZpbHRlcih2YWx1ZTogYW55LCBjb2RlPzogc3RyaW5nLCBvcHRpb25zPzogYW55KTogc3RyaW5nXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjbGFzcyBNb25leUZpbHRlciBpbXBsZW1lbnRzIElNb25leUZpbHRlciB7XHJcbiAgICAgICAgICAgIGZpbHRlcih2YWx1ZTogYW55LCBjb2RlPzogc3RyaW5nLCBvcHRpb25zPzogYW55KTogc3RyaW5nIHtcclxuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsIHx8IGFuZ3VsYXIuaXNTdHJpbmcodmFsdWUpICYmIHZhbHVlLnRyaW0oKS5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiXCI7XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIF9vcHRpb25zOiBhbnkgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJlY2lzaW9uOiBhY2NvdW50aW5nLnNldHRpbmdzLmN1cnJlbmN5LnByZWNpc2lvblxyXG4gICAgICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoYW5ndWxhci5pc09iamVjdChjb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF9vcHRpb25zID0gY29kZTtcclxuICAgICAgICAgICAgICAgICAgICBjb2RlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuYW1vdW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29kZSA9IHZhbHVlLmN1cnJlbmN5IHx8IGNvZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5hbW91bnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zKVxyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIHggaW4gb3B0aW9ucylcclxuICAgICAgICAgICAgICAgICAgICBfb3B0aW9uc1t4XSA9IG9wdGlvbnNbeF07XHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHYgPSBhY2NvdW50aW5nLnVuZm9ybWF0KHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmFiYnJldikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2ID49IDEwMDAwMDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSB2IC8gMTAwMDAwMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMucHJlY2lzaW9uID0gdmFsdWUudG9TdHJpbmcoKS5pbmRleE9mKCcuJykgPiAwID8gMSA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLmZvcm1hdCA9IFwiJXMldk1cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHYgPj0gMTAwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHYgLyAxMDAwO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfb3B0aW9ucy5wcmVjaXNpb24gPSB2YWx1ZS50b1N0cmluZygpLmluZGV4T2YoJy4nKSA+IDAgPyAxIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMuZm9ybWF0ID0gXCIlcyV2S1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih2ID49IDEwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9IHY7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLnByZWNpc2lvbiA9IHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZignLicpID4gMCA/IF9vcHRpb25zLnByZWNpc2lvbiA6IDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9vcHRpb25zLmZvcm1hdCA9IFwiJXMldlwiO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZih2ID49IDEwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlID0gdjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMucHJlY2lzaW9uID0gdmFsdWUudG9TdHJpbmcoKS5pbmRleE9mKCcuJykgPiAwID8gX29wdGlvbnMucHJlY2lzaW9uIDogMDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX29wdGlvbnMuZm9ybWF0ID0gXCIlcyV2XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIF9vcHRpb25zLnN5bWJvbCA9IGN1cnJlbmN5LnN5bWJvbGl6ZShjb2RlKTtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gYWNjb3VudGluZy5mb3JtYXRNb25leSh2YWx1ZSwgX29wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBBbmd1bGFyLm1vZHVsZShcIm5nTW9uZXlcIikuZmlsdGVyKFwibW9uZXlcIiwgTW9uZXlGaWx0ZXIpO1xyXG4gICAgfVxyXG59Il19